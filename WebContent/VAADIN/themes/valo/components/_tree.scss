$v-tree-row-height: round($v-unit-size/1.3) !default;
$v-tree-animations-enabled: false !default;


@if $v-tree-animations-enabled {
  @include keyframes(v-valo-tree-node-open) {
    0% {
      max-height: 0;
    }
    100% {
      max-height: $v-tree-row-height * 10;
    }
  }

  @include keyframes(v-valo-tree-node-close) {
    0% {
      max-height: $v-tree-row-height * 10;
    }
    100% {
      max-height: 0;
    }
  }
}


@mixin v-valo-tree ($primary-stylename: v-tree) {
  
  
  
  .#{$primary-stylename} {
    position: relative;
    white-space: nowrap;
    @extend %no-selection;
    
    &:focus {
      outline: none;
    }
  }
  
  .#{$primary-stylename}-node:before {
    content: "";
    position: absolute;
    z-index: 2;
    width: 1.9em;
    height: $v-tree-row-height;
    cursor: pointer;
  }
  	
  .#{$primary-stylename}-node-caption {
    height: $v-tree-row-height;
    line-height: $v-tree-row-height - 1px;
    overflow: hidden;
    white-space: nowrap;
    
    & > div {
      display: inline-block;
      width: 100%;
      position: relative;
      z-index: 1;
    }
    
    span {
      padding-right: $v-tree-row-height;
      cursor: pointer;
      display: inline-block;
      // Allow to click on the whole row (almost, at least the right side part)
      width: 100%;
    }

    .v-icon {
      padding-right: round($v-unit-size/6);
      width: auto;
    }

    &:before {
      content: "\f0da";
      font-family: FontAwesome;
      display: inline-block;
      margin: 0 .6em 0 1em;
      position: relative;
      z-index: 1;

      @if $v-tree-animations-enabled {
        @include transition(all 80ms);
      }
    }

    &:after {
      content: "";
      display: inline-block;
      vertical-align: top;
      position: absolute;
      left: 0;
      //top: 0;
      //margin-top: -$v-tree-row-height;
      width: 100%;
      height: $v-tree-row-height;
      //margin-top: -$v-tree-row-height;
      border-radius: $v-border-radius;
      @include v-valo-gradient(v-valo-selection-color());
      @include opacity(0);

      @if $v-tree-animations-enabled {
        @include transition(opacity 80ms);
      }
    }
  }
  
  .#{$primary-stylename}-node-expanded > .#{$primary-stylename}-node-caption:before {
  	@include transform(rotate(90deg));
  	
    @if $v-tree-animations-enabled {
      @include transition(all 80ms);
    }
  }
  
  .#{$primary-stylename}-node-selected:after {
    @include opacity(1);
  }
  
  .#{$primary-stylename}-node-selected {
    color: v-valo-font-color(v-valo-selection-color());
    text-shadow: v-valo-button-text-shadow(v-valo-selection-color(), $v-bevel-depth);
  }
  
  .#{$primary-stylename}-node-children {
  	padding-left: round($v-unit-size/2);
    overflow: hidden;
  }

  @if $v-tree-animations-enabled {
    .#{$primary-stylename}-node-children[style*="display: none"] {
      @include animation(v-valo-tree-node-close 400ms ease-out forwards);
      display: block !important;
    }

    .#{$primary-stylename}-node-expanded > .#{$primary-stylename}-node-children {
      @include animation(v-valo-tree-node-open 400ms ease-in);
    }
  }
}